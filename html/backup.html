<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" type="text/css" href="../css/freeSizeGraphStyle.css" />
    <style>
        @font-face {
            font-family: 'Flexo-Bold';
            src: url('Flexo-Bold.eot');
            src: url('Flexo-Bold.eot?#iefix') format('embedded-opentype'), url('Flexo-Bold.woff2') format('woff2'), url('Flexo-Bold.woff') format('woff'), url('Flexo-Bold.ttf') format('truetype'),
        }
    </style>
</head>

<body>

    <canvas id="canvasFreeSize" width="625" height="625">
        이 브라우저는 캔버스를 지원하지 않습니다.
    </canvas>

   <div style = "display:none">
       <img id="img_Graph" src="../img/freeSize1.svg"/>       
   </div>
   
    <script>
        var data = {
            graphType: 1, // 0 ~ 5 
            direction: 'left', // left, right
            percent: 50 // 0 ~ 100%
        };

        var FreeSizeGraph = function (elId, graphProperties) {

            var graphDefaultProperties = {
                lineCount: 12,
                centerLineValue: 6,
                canvasRatio: 2.5,
                motionValue: 10,
                fontStyle: 'Flexo-Bold',
                recommendLineColor: '#ffffff',
                circleColor: '#F3F3F0',
                imgLineColor: '#EBEBE8',
                percentTextColor: '#FBFBFB',
                recommendTextSize: 14,
                percentfontSize: 25,
                textAlign: 'center',
                imgLineWidth: 2,
                recommendLineWidth: 4,
                imgLineGeneValue: 0.3,
                recommendLineGeneValue: 1,
                circleRadius: 100,
                easyInLineRange: 8,
                easyOutLineRange: 3,
                easyInOutSpeed: 3,
                easyCenterSpeed: 7
            }
            
            var runGraph = this.drawFreeSizeGraph(elId, graphProperties);
        };

        FreeSizeGraph.prototype = {

            drawFreeSizeGraph: function (elId, graphProperties) {
                var canvasInfo = this.initCanvas(elId),
                    canvasLocationValues = this.calCanvasLocationValue(canvasInfo, graphProperties),
                    graphBackground = this.drawGraphBackground(canvasInfo, canvasLocationValues, graphProperties),
                    lineAnimation = this.drawRecommendLineUp(canvasInfo, canvasLocationValues, graphProperties);
            },

            initCanvas: function (elId) {
                var canvasFreeSize = document.getElementById(elId),
                    freeSizeContext = canvasFreeSize.getContext("2d");

                return {
                    canvasFreeSize: canvasFreeSize,
                    freeSizeContext: freeSizeContext
                }
            },

            calCanvasLocationValue: function (canvasInfo, graphProperties) {
                var canvasHalfWidth = canvasInfo.canvasFreeSize.width / 2,
                    circleAreaDivesion = canvasInfo.canvasFreeSize.width / graphProperties.lineCount,
                    lineLocationValue = (5 / 100) * data.percent,
                    leftLine = 1 + lineLocationValue,
                    rightLine = (graphProperties.lineCount - 1) - lineLocationValue,
                    lineHeightDivision = canvasInfo.canvasFreeSize.height / 10;

                return {
                    canvasHalfWidth: canvasHalfWidth,
                    circleAreaDivesion: circleAreaDivesion,
                    lineLocationValue: lineLocationValue,
                    leftLine: leftLine,
                    rightLine: rightLine,
                    lineHeightDivision: lineHeightDivision
                }
            },

            drawRecommendImg: function (canvasInfo, graphProperties) {
                var imgWidth = 200 * graphProperties.canvasRatio,
                    imgHeight = 160 * graphProperties.canvasRatio; // 데이터 값 확정 후 사이즈 변경예정.

                freeSizeGraphImg = document.getElementById("img_Graph");
                canvasInfo.freeSizeContext.drawImage(freeSizeGraphImg, (canvasInfo.canvasFreeSize.width - imgWidth) / 2, (canvasInfo.canvasFreeSize.height - imgHeight) / 1.2, imgWidth, imgHeight);         
            },

            // 클립핑 된 그래프 영역
            drawGraphBackground: function (canvasInfo, canvasLocationValues, graphProperties) {
                canvasInfo.freeSizeContext.beginPath();
                canvasInfo.freeSizeContext.arc(canvasLocationValues.canvasHalfWidth, canvasLocationValues.canvasHalfWidth, graphProperties.circleRadius * graphProperties.canvasRatio, 0, 2 * Math.PI);
                canvasInfo.freeSizeContext.strokeStyle = graphProperties.recommendLineColor;
                canvasInfo.freeSizeContext.stroke();
                canvasInfo.freeSizeContext.clip();

                canvasInfo.freeSizeContext.beginPath();
                canvasInfo.freeSizeContext.fillStyle = graphProperties.circleColor;
                canvasInfo.freeSizeContext.fillRect(0, canvasLocationValues.lineHeightDivision, canvasInfo.canvasFreeSize.width, canvasInfo.canvasFreeSize.height);
                canvasInfo.freeSizeContext.fill();
                
                this.drawRecommendImg(canvasInfo, graphProperties);

                canvasInfo.freeSizeContext.save();
                canvasInfo.freeSizeContext.beginPath();
                canvasInfo.freeSizeContext.globalAlpha = graphProperties.imgLineGeneValue;

                for (var i = 0; i < 12; i++) {
                    canvasInfo.freeSizeContext.moveTo(canvasLocationValues.circleAreaDivesion * i, canvasLocationValues.lineHeightDivision);
                    canvasInfo.freeSizeContext.lineTo(canvasLocationValues.circleAreaDivesion * i, canvasInfo.canvasFreeSize.height);
                }

                canvasInfo.freeSizeContext.lineWidth = graphProperties.imgLineWidth;
                canvasInfo.freeSizeContext.strokeStyle = graphProperties.imgLineColor;
                canvasInfo.freeSizeContext.stroke();
                canvasInfo.freeSizeContext.restore();

                canvasInfo.freeSizeContext.beginPath();
                canvasInfo.freeSizeContext.fillStyle = graphProperties.percentTextColor;
                canvasInfo.freeSizeContext.font = (graphProperties.percentfontSize * graphProperties.canvasRatio) + "px " + graphProperties.fontStyle + "";
                canvasInfo.freeSizeContext.textAlign = graphProperties.textAlign;
                canvasInfo.freeSizeContext.fillText(data.percent + '%', canvasLocationValues.canvasHalfWidth, canvasLocationValues.canvasHalfWidth * 1.2);
                canvasInfo.freeSizeContext.fill();
            },

            //라인 그리기
            drawRecommendLineUp: function (canvasInfo, canvasLocationValues, graphProperties) {
                //추천라인 상하 이동
                var lineUpCount = 0;
                var self = this;
                var lineInterval = setInterval(function () {
                    var bothEndLine = canvasInfo.canvasFreeSize.height - canvasLocationValues.lineHeightDivision;

                    canvasInfo.freeSizeContext.beginPath();
                    canvasInfo.freeSizeContext.globalAlpha = graphProperties.recommendLineGeneValue;
                    canvasInfo.freeSizeContext.moveTo(canvasLocationValues.circleAreaDivesion * (graphProperties.centerLineValue), bothEndLine);
                    canvasInfo.freeSizeContext.lineTo(canvasLocationValues.circleAreaDivesion * (graphProperties.centerLineValue), bothEndLine - lineUpCount);
                    canvasInfo.freeSizeContext.lineWidth = graphProperties.recommendLineWidth;
                    canvasInfo.freeSizeContext.strokeStyle = graphProperties.recommendLineColor;
                    canvasInfo.freeSizeContext.stroke();

                    if (canvasLocationValues.lineHeightDivision * graphProperties.easyInLineRange < bothEndLine - lineUpCount || canvasLocationValues.lineHeightDivision * graphProperties.easyOutLineRange > bothEndLine - lineUpCount) {
                        lineUpCount += graphProperties.canvasRatio / graphProperties.motionValue + graphProperties.easyInOutSpeed;

                    } else {
                        lineUpCount += graphProperties.canvasRatio / graphProperties.motionValue + graphProperties.easyCenterSpeed;

                    }

                    if (bothEndLine - lineUpCount <= canvasLocationValues.lineHeightDivision) {
                        clearInterval(lineInterval);
                        self.drawRecommendLineTurn(canvasInfo, canvasLocationValues, graphProperties);
                    }
                }, graphProperties.motionValue);
            },

            //라인 그리기
            drawRecommendLineTurn: function (canvasInfo, canvasLocationValues, graphProperties) {
                //추천라인 좌우 이동
                var lineChangeValue = 0;
                var self = this;
                var bothLineInterval = setInterval(function () {
//                    canvasInfo.freeSizeContext.clearRect(0, canvasLocationValues.lineHeightDivision, canvasInfo.canvasFreeSize.width, canvasInfo.canvasFreeSize.height);
                    self.drawGraphBackground(canvasInfo, canvasLocationValues, graphProperties);
                    
                    canvasInfo.freeSizeContext.save();
                    canvasInfo.freeSizeContext.beginPath();

                    if (data.direction == 'left') {
                        canvasInfo.freeSizeContext.moveTo(canvasLocationValues.circleAreaDivesion * (graphProperties.centerLineValue) - lineChangeValue, 0);
                        canvasInfo.freeSizeContext.lineTo(canvasLocationValues.circleAreaDivesion * (graphProperties.centerLineValue) - lineChangeValue, canvasInfo.canvasFreeSize.height);

                    } else {
                        canvasInfo.freeSizeContext.moveTo(canvasLocationValues.circleAreaDivesion * (graphProperties.centerLineValue) + lineChangeValue, 0);
                        canvasInfo.freeSizeContext.lineTo(canvasLocationValues.circleAreaDivesion * (graphProperties.centerLineValue) + lineChangeValue, canvasInfo.canvasFreeSize.height);
                    }

                    canvasInfo.freeSizeContext.lineWidth = graphProperties.recommendLineWidth;
                    canvasInfo.freeSizeContext.strokeStyle = graphProperties.recommendLineColor;
                    canvasInfo.freeSizeContext.stroke();
                    canvasInfo.freeSizeContext.restore();

                    lineChangeValue += 0.1 + lineChangeValue / graphProperties.motionValue;

                    if (data.direction == 'left' && canvasLocationValues.circleAreaDivesion * (graphProperties.centerLineValue) - lineChangeValue <= canvasLocationValues.circleAreaDivesion * canvasLocationValues.leftLine) {
                        clearInterval(bothLineInterval);

                    } else if (data.direction !== 'left' && canvasLocationValues.circleAreaDivesion * (graphProperties.centerLineValue) + lineChangeValue >= canvasLocationValues.circleAreaDivesion * canvasLocationValues.rightLine) {
                        clearInterval(bothLineInterval);

                    }
                }, graphProperties.motionValue);
            }

        };

        
        var freeSizeGraph = new FreeSizeGraph("canvasFreeSize", {
            lineCount: 12,
            centerLineValue: 6,
            canvasRatio: 2.5,
            motionValue: 10,
            fontStyle: 'Flexo-Bold',
            recommendLineColor: '#ffffff',
            circleColor: '#F3F3F0',
            imgLineColor: '#EBEBE8',
            percentTextColor: '#FBFBFB',
            recommendTextSize: 14,
            percentfontSize: 25,
            textAlign: 'center',
            imgLineWidth: 2,
            recommendLineWidth: 4,
            imgLineGeneValue: 0.3,
            recommendLineGeneValue: 1,
            circleRadius: 100,
            easyInLineRange: 8,
            easyOutLineRange: 3,
            easyInOutSpeed: 3,
            easyCenterSpeed: 7
        });
        
        
        
            var drawMeColorText = function (globalAlphaValue) { 
            var lineLocationValue = (5 / 100) * data.percent,
                lineLength = 12,
                leftLine = 1 + lineLocationValue,
                rightLine = (lineLength - 1) - lineLocationValue;
            freeSizeContext.save();
            freeSizeContext.beginPath();
            freeSizeContext.fillStyle = '#00FFB0';
            freeSizeContext.textAlign = 'center';

//            freeSizeContext.globalAlpha = 1;
            freeSizeContext.font = (14 * canvasRatio) + "px 'Flexo-Bold'";

            if (data.direction == 'left') {
                freeSizeContext.clearRect((circleAreaDivesion * leftLine) - (14 * canvasRatio), 0, (14 * canvasRatio) * 2, (14 * canvasRatio) * 2);
                if(globalAlphaValue >=0.9){
                freeSizeContext.fillText('ME!', (circleAreaDivesion * leftLine), circleAreaDivesion);    
                }                

            } else {
                freeSizeContext.clearRect((circleAreaDivesion * rightLine) - (14 * canvasRatio), 0, (14 * canvasRatio) * 2, (14 * canvasRatio) * 2);
                freeSizeContext.fillText('ME!', (circleAreaDivesion * rightLine), circleAreaDivesion);

            }

            freeSizeContext.fill();
            freeSizeContext.restore();
        }
    </script>
</body>

</html>