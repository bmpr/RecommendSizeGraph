<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        #canvas {
            display: inline-block;
            position: absolute;
            top: 10%;
            left: 10%;
        }
        
        #canvasShadow {
            display: inline-block;
            position: absolute;
            top: 10%;
            left: 10%;
        }
    </style>
</head>

<body>

    <canvas id="canvasShadow" width="270" height="270"></canvas>
    <canvas id="canvas" width="270" height="270"></canvas>

    <script>
        var recommendSizeData = {
            recommendSize: 'L',
            isCorrectGender: true,
            recommendRate: 5,
            status: true,
            sizes: ['XS', 'S', 'M', 'L', 'XL']
        }

        var recommendedSizeData = {
            sizeRate: recommendSizeData.recommendRate,
            sizeName: recommendSizeData.recommendSize,
            totalSizes: recommendSizeData.sizes
        };


        //-------------------------------------------get list---------------------------------------------------------        


        function getRecommendSizeList(totalSizeList, selectedSize) {
            var recommendedSizeList = [];
            var listAdd = "";
            var sizeListLength = totalSizeList.length;
            var minCount = 0;
            var maxCount = 0;

            for (var i = 0; i < sizeListLength; i++) {
                if (totalSizeList[i] == selectedSize) {
                    selectIndex = i;
                }
            }

            if (selectIndex < 3 && sizeListLength < 5) {
                minCount = 0;
                maxCount = sizeListLength - 1;
            } else if (selectIndex < 3 && sizeListLength > 4) {
                maxCount = 4;
            } else if (selectIndex == 3 && sizeListLength == 4) {
                maxCount = selectIndex;
            } else if (selectIndex == sizeListLength - 1) {
                minCount = selectIndex - 4;
                maxCount = selectIndex;
            } else if (selectIndex == sizeListLength - 2) {
                minCount = selectIndex - 3;
                maxCount = selectIndex + 1;
            } else if (sizeListLength > 4) {
                minCount = selectIndex - 2;
                maxCount = selectIndex + 2;
            }

            for (var i = minCount; i <= maxCount; i++) {
                recommendedSizeList.push(totalSizeList[i]);
            }
            return recommendedSizeList;
        };


        function initCircleGraphCanvas() {
            var textCanvas = document.getElementById("canvas");
            var shadowCanvas = document.getElementById("canvasShadow");

            var textContext = textCanvas.getContext("2d");
            var shadowContext = shadowCanvas.getContext("2d");

            return {
                textContext: textContext,
                shadowCanvas: shadowCanvas,
                shadowContext: shadowContext
            };
        }

        //-------------------------------------------background shadow---------------------------------------------------------


        function drawCircleGraphShadow(canvas, canvasContext, selectedSizeList, recommendedSize, recommendedSizeRate) {
            var canvasHalfWidth = canvas.width / 2;
            var recommendedSizeIndex = selectedSizeList.indexOf(recommendedSize);

            var motionValue = 100;
            var piePieceAllMotion = 18 * motionValue;
            var piePieceMotion = 4 * motionValue;
            var drawRadian = ((2 * Math.PI) / piePieceAllMotion) * piePieceMotion;
            var blurUp = 0;

            var pieGraphInterval = setInterval(function () {
                canvasContext.clearRect(0, 0, canvas.width, canvas.height);
                moveShadow(blurUp);
                blurUp += 0.05;

                if (blurUp > 1) {
                    clearInterval(pieGraphInterval);
                }
            }, motionValue);

            function moveShadow(blurUp) {

                var calculatedsizeIndex = (Math.PI / 18) * (recommendedSizeIndex * 6 + 3);
                var stratPoint = (0.45 * Math.PI) + calculatedsizeIndex;

                canvasContext.beginPath();
                canvasContext.moveTo(canvasHalfWidth, canvasHalfWidth);
                canvasContext.arc(canvasHalfWidth, canvasHalfWidth, canvasHalfWidth / 1.35, stratPoint, stratPoint + drawRadian, false);
                canvasContext.shadowColor = "rgba(32,96,122," + blurUp + ")";
                canvasContext.shadowBlur = 40;
                canvasContext.closePath();
                canvasContext.fill();

                canvasContext.beginPath();
                canvasContext.moveTo(canvasHalfWidth, canvasHalfWidth);
                canvasContext.arc(canvasHalfWidth, canvasHalfWidth, canvasHalfWidth / 1.35, stratPoint, stratPoint + drawRadian, true);
                canvasContext.shadowColor = "rgba(227,237,168," + blurUp + ")";
                canvasContext.shadowBlur = 30;
                canvasContext.fill();
            }

        }

        //-------------------------------------------text align----------------------------------------------------------


        function drawSizeText(canvasContext, sizeList, recommendedSize) {
            var angle, num;
            var sizeNameCount;
            var labelCount = 0;
            var radius = canvas.height / 2;
            var sizeCount = sizeList.indexOf(recommendedSize);
            var sizeCountUp = sizeCount + 1;

            canvasContext.translate(radius, radius);
            radius = radius * 0.79;

            canvasContext.beginPath();
            canvasContext.arc(0, 0, radius / 1.06, 0, 2 * Math.PI);
            canvasContext.fillStyle = 'white';
            canvasContext.fill();

            canvasContext.font = "16px arial";
            canvasContext.textBaseline = "middle";
            canvasContext.textAlign = "center";

            for (num = 12; num < 25; num++) {
                sizeNameCount = num.toString() - 9;
                angle = num * 3.14 / 9;

                canvasContext.rotate(angle);
                canvasContext.translate(0, -radius * 0.8);
                canvasContext.rotate(-angle);
                canvasContext.fillStyle = "#F6F5F3";

                if (num > 6 && num < 12) {
                    canvasContext.fillText("", 0, 0);

                } else if (sizeNameCount % 3 == 0) {
                    if (sizeList[labelCount] == recommendedSize) {
                        canvasContext.fillStyle = "rgba(0,255,176,1)";
                        canvasContext.fillText(sizeList[labelCount], 0, 0);
                    }
                    canvasContext.fillText(sizeList[labelCount], 0, 0);
                    labelCount++;
                } else if (sizeCountUp * 3 - 2 <= sizeNameCount && sizeCountUp * 3 + 2 >= sizeNameCount) {
                    canvasContext.fillStyle = "rgba(32,96,122,1)";
                    canvasContext.fillText(".", 0, 0);
                } else if (sizeNameCount % 3 !== 0) {
                    canvasContext.fillText(".", 0, 0);
                }
                canvasContext.rotate(angle);
                canvasContext.translate(0, radius * 0.8);
                canvasContext.rotate(-angle);
            }
        }

        function drawPointerText(canvasContext, sizeList, recommendedSize, recommendedSizeRate) {
            var angle, num;
            var sizeNameCount;
            var recommendedSizeIndex = sizeList.indexOf(recommendedSize);
            var radius = canvas.height / 2 * 0.5;

            canvasContext.font = "14px arial";
            canvasContext.textAlign = "center";

            for (num = 12; num < 25; num++) {
                sizeNameCount = num.toString() - 9;
                angle = (num * Math.PI / 9) + (recommendedSizeRate * 0.1);

                canvasContext.rotate(angle);
                canvasContext.translate(0, -radius * 1.8);
                canvasContext.rotate(-angle);

                if (sizeNameCount % 3 == 0 && sizeNameCount / 3 - 1 == recommendedSizeIndex) {
                    canvasContext.fillStyle = "#00FFB0";
                    canvasContext.fillText("ME!", 0, 0);
                }

                canvasContext.rotate(angle);
                canvasContext.translate(0, radius * 1.8);
                canvasContext.rotate(-angle);
            }
        }

        function drawCircleGraph() {
            var canvasInfo = initCircleGraphCanvas();
            var selectedSizeList = getRecommendSizeList(recommendedSizeData.totalSizes, recommendedSizeData.sizeName);

            drawSizeText(canvasInfo.textContext, selectedSizeList, recommendedSizeData.sizeName);
            drawPointerText(canvasInfo.textContext, selectedSizeList, recommendedSizeData.sizeName, recommendedSizeData.sizeRate);

            drawCircleGraphShadow(canvasInfo.shadowCanvas, canvasInfo.shadowContext, selectedSizeList, recommendedSizeData.sizeName, recommendedSizeData.sizeRate);
        }

        drawCircleGraph();
    </script>
</body>

</html>