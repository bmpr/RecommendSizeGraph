<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        #canvas {
            display: inline-block;
            position: absolute;
            top: 10%;
            left: 10%;
        }
        
        #canvasShadow {
            display: inline-block;
            position: absolute;
            top: 10%;
            left: 10%;
        }
        
        #canvasTest {
            display: inline-block;
            position: absolute;
            top: 10%;
            left: 10%;
        }
    </style>
</head>

<body>

    <!--    <canvas id="canvasTest" width="270" height="270"></canvas>-->
    <canvas id="canvasShadow" width="270" height="270"></canvas>
    <canvas id="canvas" width="270" height="270"></canvas>

    <script>
        var recommendSizeData = {
            recommendSize: 'M',
            isCorrectGender: true,
            recommendRate: 0,
            status: true,
            sizes: ['XS', 'S', 'M', 'L', 'XL', 'XXL', 'XXXL']
        }

        //-------------------------------------------background shadow---------------------------------------------------------

        function circleGraphDraw() {
            var canvas = document.getElementById("canvasShadow");
            var cx = canvas.getContext("2d");
            var canvasHalfWidth = canvas.width / 2;
            var recommendedSizeIndex = recommendSizeData.sizes.indexOf(recommendSizeData.recommendSize);

            
                var i = 0;
                var motionValue = 10;
                var piePieceAllMotion = 20 * motionValue; 
                var piePieceMotion = 5 * motionValue; 

                var pieGraphInterval = setInterval(function () {
                    i = i + 1;
                    cx.clearRect(0, 0, canvas.width, canvas.height);
                    var drawRad = ((2 * Math.PI) / piePieceAllMotion) * i + 0.5;
                    circleGraphDrawInner(drawRad);

                    if (i == piePieceMotion) {
                        clearInterval(pieGraphInterval);
                    }
                }, motionValue);
            

            function circleGraphDrawInner(rad) {
                cx.beginPath();
                cx.moveTo(canvasHalfWidth, canvasHalfWidth);
                cx.arc(canvasHalfWidth, canvasHalfWidth, canvasHalfWidth / 1.4 + 10, ((recommendedSizeIndex * 0.33) + 0.505) * Math.PI, rad + ((recommendedSizeIndex * 0.33) + 0.505) * Math.PI, false);
                cx.shadowColor = "#FE7E84";
                cx.shadowBlur = 40;
                cx.closePath();
                cx.fillStyle = "red";
                cx.fill();
            }
        }

        //-------------------------------------------text align----------------------------------------------------------

        (function () {

            var canvas = document.getElementById("canvas");
            var ctx = canvas.getContext("2d");
            var radius = canvas.height / 2;
            
            ctx.translate(radius, radius);
            radius = radius * 0.79;

            function drawSizeText() { // 캔버스 안 사이즈 배치
                var angle, num;
                var sizeNameCount;
                var labelCount = 0;
                var sizeLabelList = recommendSizeData.sizes;

                ctx.beginPath();
                ctx.arc(0, 0, radius, 0, 2 * Math.PI);
                ctx.fillStyle = 'white';
                ctx.fill();

                ctx.font = "16px arial";
                ctx.textBaseline = "middle";
                ctx.textAlign = "center";

                for (num = 12; num < 25; num++) {
                    sizeNameCount = num.toString() - 9;
                    angle = num * 3.14 / 9;

                    ctx.rotate(angle);
                    ctx.translate(0, -radius * 0.85);
                    ctx.rotate(-angle);

                    if (num > 6 && num < 12) {
                        ctx.fillText("", 0, 0);
                    } else if (sizeNameCount % 3 == 0) {
                        ctx.fillStyle = "#FE7E84";
                        ctx.fillText(sizeLabelList[labelCount], 0, 0);
                        labelCount++;
                    } else if (sizeNameCount % 3 !== 0) {
                        ctx.fillStyle = "gray";
                        ctx.fillText(".", 0, 0);
                    }

                    ctx.rotate(angle);
                    ctx.translate(0, radius * 0.85);
                    ctx.rotate(-angle);
                }
            }

            function drawThisText() { // This! 
                var angle, num;
                var sizeNameCount;
                var recommendedSizeIndex = recommendSizeData.sizes.indexOf(recommendSizeData.recommendSize);

                ctx.font = "11px arial";
                ctx.textAlign = "center";

                for (num = 12; num < 25; num++) {
                    sizeNameCount = num.toString() - 9;
                    angle = num * 3.14 / 9;

                    ctx.rotate(angle);
                    ctx.translate(0, -radius * 0.65);
                    ctx.rotate(-angle);

                    if (sizeNameCount % 3 == 0 && sizeNameCount / 3 - 1 == recommendedSizeIndex) {
                        ctx.fillStyle = "#FE7E84";
                        ctx.fillText("this!", 0, 0);
                    } else {
                        ctx.fillText("", 0, 0);
                    }

                    ctx.rotate(angle);
                    ctx.translate(0, radius * 0.65);
                    ctx.rotate(-angle);
                }

                //        (function test() { // 테스트 라인 
                //            var canvas = document.getElementById("canvasTest");
                //            var cx = canvas.getContext("2d");
                //            var canvasHalfWidth = canvas.width / 2;
                //            var j = 0.11;
                //
                //            cx.beginPath();
                //            for (var i = 1; i < 19; i++) {
                //                cx.moveTo(canvasHalfWidth, canvasHalfWidth); // 중심점
                //                cx.arc(canvasHalfWidth, canvasHalfWidth, canvasHalfWidth, -0.825 + j * Math.PI, -0.825 + j * Math.PI, false);   
                //                j += 0.11;
                //            }
                //            cx.closePath();
                //            cx.strokeStyle = "red";
                //            cx.stroke();
                //        })();
            }

            function drawCircleGraph() {
                drawSizeText();
                drawThisText();
                circleGraphDraw();
            }
            drawCircleGraph();
        })();
    </script>
</body>

</html>