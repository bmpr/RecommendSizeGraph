<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        #canvas {
            display: inline-block;
            position: absolute;
            top: 10%;
            left: 10%;
        }
        
        #canvasShadow {
            display: inline-block;
            position: absolute;
            top: 10%;
            left: 10%;
        }
        
        #canvasTest {
            display: inline-block;
            position: absolute;
            top: 10%;
            left: 10%;
        }
    </style>
</head>

<body>

    <canvas id="canvasTest" width="270" height="270"></canvas>
    <canvas id="canvasShadow" width="270" height="270"></canvas>
    <canvas id="canvas" width="270" height="270"></canvas>

    <script>
        var recommendSizeData = {
            recommendSize: 'S',
            isCorrectGender: true,
            recommendRate: 0,
            status: true,
            sizes: ['XS', 'S', 'M', 'L', 'XL']
        }

        var recommendedSizeData = {
            sizeRate: recommendSizeData.recommendRate,
            sizeName: recommendSizeData.recommendSize,
            totalSizes: recommendSizeData.sizes
        };
        
        //-------------------------------------------get list---------------------------------------------------------        
        
        function getRecommendSizeList(totalSizeList, selectedSize) {
            var recommendedSizeList = [];
            var listAdd = "";
            var sizeListLength = totalSizeList.length;
            var minCount = 0;
            var maxCount = 0;

            for (var i = 0; i < sizeListLength; i++) {
                if (totalSizeList[i] == selectedSize) {
                    selectIndex = i;
                }
            }

            if (selectIndex < 3 && sizeListLength < 5) {
                minCount = 0;
                maxCount = sizeListLength - 1;
            } else if (selectIndex < 3 && sizeListLength > 4) {
                maxCount = 4;
            } else if (selectIndex == 3 && sizeListLength == 4) {
                maxCount = selectIndex;
            } else if (selectIndex == sizeListLength - 1) {
                minCount = selectIndex - 4;
                maxCount = selectIndex;
            } else if (selectIndex == sizeListLength - 2) {
                minCount = selectIndex - 3;
                maxCount = selectIndex + 1;
            } else if (sizeListLength > 4) {
                minCount = selectIndex - 2;
                maxCount = selectIndex + 2;
            }

            for (var i = minCount; i <= maxCount; i++) {
                recommendedSizeList.push(totalSizeList[i]);
            }
            return recommendedSizeList;
        };

        
        function initCircleGraphCanvas() {
            var textCanvas = document.getElementById("canvas");
            var shadowCanvas = document.getElementById("canvasShadow");
            
            var textContext = textCanvas.getContext("2d");
            var shadowContext = shadowCanvas.getContext("2d");

            return {
                textContext : textContext,
                shadowCanvas : shadowCanvas,
                shadowContext : shadowContext,
            };
        }
        
        //-------------------------------------------background shadow---------------------------------------------------------
        

        function drawCircleGraphShadow(canvas, canvasContext, selectedSizeList, recommendedSize ,recommendedSizeRate) {
            var canvasHalfWidth = canvas.width / 2;
            var recommendedSizeIndex = selectedSizeList.indexOf(recommendedSize);

            var i = 0;
            var motionValue = 15;
            var piePieceAllMotion = 18 * motionValue;
            var piePieceMotion = 3 * motionValue;

            var pieGraphInterval = setInterval(function () {
                i = i + 1;
                canvasContext.clearRect(0, 0, canvas.width, canvas.height);
                var drawRadian = ((2 * Math.PI) / piePieceAllMotion) * i;
                moveShadow(drawRadian, canvasContext);

                if (i == piePieceMotion) {
                    clearInterval(pieGraphInterval);
                }
            }, motionValue);

            
            function moveShadow(addRadian, canvasContext) {

                var calculatedsizeIndex = (Math.PI / 18) * (recommendedSizeIndex * 6 + 3);
                var calculatedRateValue = (addRadian / 10) * recommendedSizeRate;
                var stratPoint = (0.5 * Math.PI) + calculatedsizeIndex;

                canvasContext.beginPath();
                canvasContext.moveTo(canvasHalfWidth, canvasHalfWidth);
                canvasContext.arc(canvasHalfWidth, canvasHalfWidth, canvasHalfWidth / 1.3, stratPoint + calculatedRateValue, (stratPoint + calculatedRateValue) + addRadian, false);
                canvasContext.shadowColor = "#FE7E84";
                canvasContext.shadowBlur = 40;
                canvasContext.closePath();
                canvasContext.fillStyle = "red"
                canvasContext.fill();

            }
        }

        
        //-------------------------------------------text align----------------------------------------------------------
        

        function drawSizeText(canvasContext, sizeList, recommendedSize) {
            var angle, num;
            var sizeNameCount;
            var labelCount = 0;
            var radius = canvas.height / 2;

            canvasContext.translate(radius, radius);
            radius = radius * 0.79;

            canvasContext.beginPath();
            canvasContext.arc(0, 0, radius, 0, 2 * Math.PI);
            canvasContext.fillStyle = 'white';
            canvasContext.fill();

            canvasContext.font = "15px arial";
            canvasContext.textBaseline = "middle";
            canvasContext.textAlign = "center";

            for (num = 12; num < 25; num++) {
                sizeNameCount = num.toString() - 9;
                angle = num * 3.14 / 9;

                canvasContext.rotate(angle);
                canvasContext.translate(0, -radius * 0.85);
                canvasContext.rotate(-angle);
                canvasContext.fillStyle = "gray";

                if (num > 6 && num < 12) {
                    canvasContext.fillText("", 0, 0);
                } else if (sizeNameCount % 3 == 0) {
                    if (sizeList[labelCount] == recommendedSize) {
                        canvasContext.fillStyle = "#FE7E84";
                        canvasContext.fillText(sizeList[labelCount], 0, 0);
                    }
                    canvasContext.fillText(sizeList[labelCount], 0, 0);
                    labelCount++;
                } else if (sizeNameCount % 3 !== 0) {
                    canvasContext.fillText(".", 0, 0);
                }

                canvasContext.rotate(angle);
                canvasContext.translate(0, radius * 0.85);
                canvasContext.rotate(-angle);
            }
        }

        function drawPointerText(canvasContext, sizeList, recommendedSize, recommendedSizeRate) {
            var angle, num;
            var sizeNameCount;
            var recommendedSizeIndex = sizeList.indexOf(recommendedSize);
            var radius = canvas.height / 2 * 0.5;

            canvasContext.font = "11px arial";
            canvasContext.textAlign = "center";

            for (num = 12; num < 25; num++) {
                sizeNameCount = num.toString() - 9;
                angle = (num * Math.PI / 9) + (recommendedSizeRate * 0.1);

                canvasContext.rotate(angle);
                canvasContext.translate(0, -radius);
                canvasContext.rotate(-angle);

                if (sizeNameCount % 3 == 0 && sizeNameCount / 3 - 1 == recommendedSizeIndex) {
                    canvasContext.fillStyle = "#FE7E84";
                    canvasContext.fillText("This!", 0, 0);
                }

                canvasContext.rotate(angle);
                canvasContext.translate(0, radius);
                canvasContext.rotate(-angle);
            }
        }

        function drawCircleGraph() {
            var canvasInfo = initCircleGraphCanvas();
            var selectedSizeList = getRecommendSizeList(recommendedSizeData.totalSizes, recommendedSizeData.sizeName);
            
            drawSizeText(canvasInfo.textContext, selectedSizeList, recommendedSizeData.sizeName);
            drawPointerText(canvasInfo.textContext, selectedSizeList, recommendedSizeData.sizeName, recommendedSizeData.sizeRate);
            
            drawCircleGraphShadow(canvasInfo.shadowCanvas, canvasInfo.shadowContext, selectedSizeList, recommendedSizeData.sizeName, recommendedSizeData.sizeRate);
        }
        
        drawCircleGraph();
        
    </script>
</body>

</html>